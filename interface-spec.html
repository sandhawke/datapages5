<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Datapages&#8201;&#8212;&#8201;streaming json database manager</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Datapages&#8201;&#8212;&#8201;streaming json database manager</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_design_concepts">1. Design Concepts</a></li>
<li><a href="#_standard_methods_on_a_db_database_view">2. Standard methods on a db (database view)</a>
<ul class="sectlevel2">
<li><a href="#_db_create_obj_ondurable">2.1. db.create(obj, ondurable)</a></li>
<li><a href="#_db_update_current_page_overlay_done">2.2. db.update(current-page, overlay, done)</a></li>
<li><a href="#_db_delete_page_done">2.3. db.delete(page, done)</a></li>
<li><a href="#_db_on_db_off_db_once">2.4. db.on / db.off / db.once</a></li>
<li><a href="#_db_filter_expr_aka_db_query_expr_aka_db_where_expr">2.5. db.filter(expr)   aka    db.query(expr)   aka db.where(expr)</a></li>
<li><a href="#__planned_db_count">2.6. [PLANNED] db.count()</a></li>
<li><a href="#__planned_db_sort_prop_or_prop_array_returned_dbview_with_ordering">2.7. [PLANNED] db.sort(prop-or-prop-array) &#8658; returned dbview with ordering</a></li>
<li><a href="#__planned_db_limit_n_returns_dbview_with_max_n_pages">2.8. [PLANNED] db.limit(n) &#8658; returns dbview with max n pages</a></li>
<li><a href="#__idea_db_select_arrayofpropertynames_aka_db_project">2.9. [IDEA] db.select(arrayOfPropertyNames)   aka db.project(&#8230;&#8203;)</a></li>
<li><a href="#__idea_db_join_n">2.10. [IDEA] db.join(n)</a></li>
</ul>
</li>
<li><a href="#_events">3. Events</a>
<ul class="sectlevel2">
<li><a href="#_event_appear">3.1. Event: appear</a></li>
<li><a href="#_event_disappear">3.2. Event: disappear</a></li>
<li><a href="#_event_stable">3.3. Event: stable</a></li>
<li><a href="#_event_progress">3.4. Event: progress</a></li>
<li><a href="#_event_results">3.5. Event: results</a></li>
<li><a href="#_event_updating">3.6. Event: updating</a></li>
<li><a href="#_event_updated">3.7. Event: updated</a></li>
<li><a href="#_event_changed">3.8. Event: changed</a></li>
<li><a href="#_event_error">3.9. Event: error</a></li>
</ul>
</li>
<li><a href="#_media_pages">4. Media Pages</a></li>
<li><a href="#_vocabulary">5. Vocabulary</a></li>
<li><a href="#_instance_types">6. Instance Types</a>
<ul class="sectlevel2">
<li><a href="#_inmem_basic_in_memory_store">6.1. Inmem: basic in-memory store</a></li>
<li><a href="#_filestore_on_disk_each_page_is_its_own_file">6.2. Filestore: on disk, each page is its own file</a></li>
<li><a href="#__planned_proxyclient_estream_appears_as_db_but_all_operations_to_an_eventemitter">6.3. [PLANNED] ProxyClient(estream): appears as db, but all operations to an eventemitter</a>
<ul class="sectlevel3">
<li><a href="#_companion_to_proxyserver_an_eventemitter_which_wraps_a_db">6.3.1. Companion to ProxyServer: an eventemitter which wraps a db</a></li>
</ul>
</li>
<li><a href="#__planned_cache_wrapper_which_caches_some_all_of_the_underlying_db">6.4. [PLANNED] Cache: wrapper which caches some/all of the underlying db</a></li>
<li><a href="#__planned_multisource_wrapper_for_1_write_n_read_dbs_appearing_as_one_db">6.5. [PLANNED] Multisource: wrapper for 1-write N-read dbs, appearing as one db</a>
<ul class="sectlevel3">
<li><a href="#_db_include">6.5.1. db.include()</a></li>
</ul>
</li>
<li><a href="#__idea_accesscontrolled_gives_a_partial_view_of_a_db_based_on_user_attributes">6.6. [IDEA] Accesscontrolled: gives a partial view of a db based on 'user' attributes</a></li>
<li><a href="#__idea_sigma_wrapper_which_turns_an_append_only_db_of_deltas_into_a_normal_db">6.7. [IDEA] Sigma: wrapper which turns an append-only db of deltas into a normal db</a>
<ul class="sectlevel3">
<li><a href="#_db_deltas_links_to_underlying_dbview_with_deltas">6.7.1. db.deltas links to underlying dbview with deltas</a></li>
</ul>
</li>
<li><a href="#__idea_appendfile_on_disk_store_only_handles_deltas">6.8. [IDEA] Appendfile: on disk store, only handles deltas</a></li>
<li><a href="#__idea_rulebase_computes_virtual_properties_virtual_pages_and_checks_validity">6.9. [IDEA] Rulebase: computes virtual properties, virtual pages, and checks validity</a></li>
<li><a href="#__idea_equalityreasoner">6.10. [IDEA] EqualityReasoner</a>
<ul class="sectlevel3">
<li><a href="#_db_addkey_prop">6.10.1. db.addKey (prop)</a></li>
<li><a href="#_db_issamesubjectas_a_b">6.10.2. db.isSameSubjectAs (a, b)</a></li>
<li><a href="#_db_makesamesubjectas_a_b">6.10.3. db.makeSameSubjectAs (a, b)</a></li>
<li><a href="#_db_issamepageas_a_b">6.10.4. db.isSamePageAs (a, b)</a></li>
<li><a href="#_db_makesamesubjectas_a_b_2">6.10.5. db.makeSameSubjectAs (a, b)</a></li>
<li><a href="#_db_refmod_property_type">6.10.6. db.refmod(property, type)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Everything should be made as simple as possible, but not simpler</em>&#8201;&#8212;&#8201;<a href="http://quoteinvestigator.com/2011/05/13/einstein-simple/">Einstein</a></p>
</div>
<div class="paragraph">
<p>Features (some not yet implemented):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Very fast for small datasets (thousands of records)</p>
</li>
<li>
<p>Data records are JSON-compatible JavaScript objects</p>
</li>
<li>
<p>Objects can refer to each other naturally (like <code>alice.mother.mother.age</code>, cycles are okay)</p>
</li>
<li>
<p>Instances can be linked into a federation (eg between web client and web server), with efficient propagation</p>
</li>
<li>
<p>Easy to build live displays of dynamically-changing query results (no
polling)</p>
</li>
<li>
<p>Supports transient records, aka event streaming</p>
</li>
<li>
<p>Supports streaming attached media blobs, eg JPEGs</p>
</li>
<li>
<p>Works with <a href="https://github.com/sandhawke/vocabspec">vocabspec</a> to handle
schema validation, migration (with views), and integration</p>
</li>
<li>
<p>Supports temporal and provenance features (only show data resulting from sources users a and b before time t)</p>
</li>
<li>
<p>Supports access control for use in multiuser backends</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_concepts">1. Design Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standard_methods_on_a_db_database_view">2. Standard methods on a db (database view)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 'ondurable' argument is always optional and is mostly useful for
UI operations, giving the user feedback that it&#8217;s completed.  We could
use promises.   (Is that efficient when it&#8217;s usually ignored?)</p>
</div>
<div class="sect2">
<h3 id="_db_create_obj_ondurable">2.1. db.create(obj, ondurable)</h3>
<div class="paragraph">
<p>If obj is not already in db, creates a new datapage</p>
</div>
<div class="paragraph">
<p>ISSUE: consider calling 'add', since sometimes that feels more right</p>
</div>
<div class="paragraph">
<p>On return, source-object is modified to have a unique-in-this-db
'__id' property which is required on subsequent calls to update and
delete, and can be used in filtering (for properties whose value is an
object).</p>
</div>
<div class="paragraph">
<p>done is called with the page once it&#8217;s in persistent storage and has
been assigned a URL.  It&#8217;s passed the page as currently known.  It&#8217;s
fine to create lots of objects, update them, and even delete them,
before the first done(&#8230;&#8203;)  is called.  Realistically, you could do a
million creates before done(&#8230;&#8203;) is called.</p>
</div>
</div>
<div class="sect2">
<h3 id="_db_update_current_page_overlay_done">2.2. db.update(current-page, overlay, done)</h3>

</div>
<div class="sect2">
<h3 id="_db_delete_page_done">2.3. db.delete(page, done)</h3>

</div>
<div class="sect2">
<h3 id="_db_on_db_off_db_once">2.4. db.on / db.off / db.once</h3>
<div class="paragraph">
<p>Request to have a function called when database state changes.
Details are below in the list of events.  Probably implemented with
EventEmitter3, but use of methods other than .on .off and .once is not
supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="_db_filter_expr_aka_db_query_expr_aka_db_where_expr">2.5. db.filter(expr)   aka    db.query(expr)   aka db.where(expr)</h3>

</div>
<div class="sect2">
<h3 id="__planned_db_count">2.6. [PLANNED] db.count()</h3>

</div>
<div class="sect2">
<h3 id="__planned_db_sort_prop_or_prop_array_returned_dbview_with_ordering">2.7. [PLANNED] db.sort(prop-or-prop-array) &#8658; returned dbview with ordering</h3>
<div class="paragraph">
<p>If a db is ordered, then .limit makes a lot more sense.</p>
</div>
<div class="paragraph">
<p>Also db.first(), db.last(), db.index(0), db.index(-1)</p>
</div>
</div>
<div class="sect2">
<h3 id="__planned_db_limit_n_returns_dbview_with_max_n_pages">2.8. [PLANNED] db.limit(n) &#8658; returns dbview with max n pages</h3>
<div class="paragraph">
<p>Aka db.slice(0, n-1)</p>
</div>
</div>
<div class="sect2">
<h3 id="__idea_db_select_arrayofpropertynames_aka_db_project">2.9. [IDEA] db.select(arrayOfPropertyNames)   aka db.project(&#8230;&#8203;)</h3>
<div class="paragraph">
<p>A performance hint, telling the underlying system that it&#8217;s safe to
ignore all properties not in the given list.  That is, it returns a
dbview where no effort is made to report the values of properties not
in this list.  Could be read as "properties I care about".</p>
</div>
<div class="paragraph">
<p>If your on-appear listener only looks at three properties, then it&#8217;s good to put a .select() for those three properties before the .on(), so no effort is made to transport and even compute the values for those properties.</p>
</div>
<div class="paragraph">
<p>The default is all defined properties, as per vocabspec.</p>
</div>
<div class="paragraph">
<p>Behavior is undefined if you update or create with properties not in
the select list.</p>
</div>
<div class="paragraph">
<p>Note that SELECT A WHERE B="FOO" has to be done like:</p>
</div>
<div class="paragraph">
<p>db.where({b: 'foo'}).select('a')</p>
</div>
<div class="paragraph">
<p>NOT db.select('a').where({b: 'foo'}) because .where can&#8217;t even see b,
because it wasn&#8217;t passed through by .select('a')</p>
</div>
</div>
<div class="sect2">
<h3 id="__idea_db_join_n">2.10. [IDEA] db.join(n)</h3>
<div class="paragraph">
<p>Returns a read-only dbview containing n-tuples where each position has each element in db.</p>
</div>
<div class="paragraph">
<p>For example, if db contains {a:1} and {a:2}:</p>
</div>
<div class="paragraph">
<p>then db.join(2) is
       {1:{a:1}, 2:{a:1}}
       {1:{a:1}, 2:{a:2}}
       {1:{a:2}, 2:{a:1}}
       {1:{a:2}, 2:{a:2}}</p>
</div>
<div class="paragraph">
<p>db.join(3) is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{1:{a:1}, 2:{a:1}, 3:{a:1}}
{1:{a:1}, 2:{a:1}, 3:{a:2}}
...
{1:{a:2}, 2:{a:2}, 3:{a:2}}</pre>
</div>
</div>
<div class="paragraph">
<p>This allows relational database joins to be expressed within the
datapages formalism.  Actually traversing the results of a join is not
recommended and might not be supported (an n-way join of a datapage
with k pages will have k^n pages).  Instead, the join should be
followed immediately by a .where, which can implement a more efficient
search.</p>
</div>
<div class="paragraph">
<p>For example, in SQL given tables LIKES (person, food) and FOODFROM (food, origin), the query SELECT person, origin WHERE LIKES.food = FOODFROM.food would be</p>
</div>
<div class="paragraph">
<p>db.join(2)
  .where({'1.isLIKE': true,
          '2.isFOODFROM': true,
          '1.food': {$valueOfProperty: '2.food'}})
  .select(['1.person', '2.origin'])</p>
</div>
<div class="paragraph">
<p>(Consider making it .joinWhere(n, filterexpr, renames) to avoid issues.)</p>
</div>
<div class="paragraph">
<p>This can probably be done more cleanly as a virtual page rule:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>db.addVirtualPageRule({likes: 'person, food',
                       foodfrom: 'food, origin'},
                      'person, origin',
                       (likes, foodfrom)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>db.addVirtualPageRule('person, likesFoodFrom', 'person, food', 'food, origin',
                      (likes, foodfrom) =&gt; {
                         if (likes.food === foodfrom.food) {
                            return {person: likes.person,
                                    likesFoodFrom: foodfrom.origin}
                         }
                      }</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;d be nice to have better filter exprs, like <code>{ food: {$wanted: true}, origin: {$exists: true} }</code></p>
</div>
<div class="paragraph">
<p>We could do forward chaining just running that blindly, but for
backward chaining we&#8217;d want a lot more.   Maybe</p>
</div>
<div class="literalblock">
<div class="content">
<pre>db.$exists = {$exists: true} // etc
db.addVirtualPageRule({person: db.$exists, likesFoodFrom: db.$exists},
                      [{person: db.$exists,
                        food: db.$exists},
                       {food: {$eq: {$valueOfProperty: '0.food'}},
                        ...</pre>
</div>
</div>
<div class="paragraph">
<p>OR just a simple statement of === join fields.  Other relations are
less useful for optimizing.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>db.join(['food', 'food']) ....   that doesn't quite work, I expect.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_events">3. Events</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_event_appear">3.1. Event: appear</h3>
<div class="paragraph">
<p>Emitted when a new page appears in the dbview, passed that page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_disappear">3.2. Event: disappear</h3>
<div class="paragraph">
<p>Emitted when a page goes away from the dbview, passed that page.</p>
</div>
<div class="paragraph">
<p>(Maybe we want a cheaper version, disappearId, which is only passed
the id.  But it&#8217;s not clear the id is the thing you care about.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_stable">3.3. Event: stable</h3>

</div>
<div class="sect2">
<h3 id="_event_progress">3.4. Event: progress</h3>
<div class="paragraph">
<p>Emitted with (stepsDone, totalSteps), at least once per second during
long operations.  stepsDone will always increase (unless things are
restarted), but totalSteps might also, so the fraction complete
(stepsDone / totalSteps) might decrease.  'stable' occurs when
stepsDone === totalSteps.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_results">3.5. Event: results</h3>
<div class="paragraph">
<p>Emitted the same time as 'stable', but given an Array (or Array-like
object) containing a frozen copy of the current db.  Producing and/or
maintaining that copy might be expensive, so us 'stable' unless you&#8217;re
actually going to use that parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_updating">3.6. Event: updating</h3>
<div class="paragraph">
<p>Properties of one of the pages in the db is about to change</p>
</div>
<div class="paragraph">
<p>Passed (old value, overlay), <strong>before</strong> the overlay has been applied.</p>
</div>
<div class="paragraph">
<p>Contrast with 'updated', this allows filtering based on what the old
value was without having to remember it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_updated">3.7. Event: updated</h3>
<div class="paragraph">
<p>Passed (new value, overlay), without any way to tell what the old value was</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_changed">3.8. Event: changed</h3>
<div class="paragraph">
<p>Emitted whenever stable or updated?  Somethat that&#8217;s useful
arraydom.CleverDOMDriver, still to be exactly sorted.  Are those
functions passed 'results'?  Probably.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">[myFunc, {css}, db.where(...).sort(...)]
     myFunc(attrs, results)

[dbbind(myFunc, db.where(...).sort(...))]



 [cyan.view(myFunc, db...), {css}]
 cyan.view(myFunc, db...)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_error">3.9. Event: error</h3>
<div class="paragraph">
<p>Some asynchronous error has occured.  Passed an object with .message
and .code, where .code is listed under [Errors].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_media_pages">4. Media Pages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some datapages have an attached digital media instance, such as a jpeg
image or an mp3 audio sample.  This attachment is handled efficiently
as a "blob", not part of the datapage itself.</p>
</div>
<div class="paragraph">
<p>Every media page has a mediaType property, which has the normal IANA
media type information, like 'image/jpeg'.  (Encoding&#8230;&#8203;?)</p>
</div>
<div class="paragraph">
<p>The media instance data itself can be accessed via a streaming API:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>db.mediaReadStrean(page, options) returns a readable stream</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>db.mediaWriteStream(page, mediaType, options) returns a writable stream</pre>
</div>
</div>
<div class="paragraph">
<p>When end() is called on the writable stream , the mediaType will be
set and db.mediaReadStream will work.</p>
</div>
<div class="paragraph">
<p>Concurrency during writes is not allowed: betwen the time
mediaWriteStream is called and the stream&#8217;s end() function is called,
other calls to either of these functions will return null.  In theory
we should track the open read streams as well.  Also, in theory, we
could just pause the non-winning readers and writers, rather than
returning null.   Tricky.</p>
</div>
<div class="paragraph">
<p>(When there&#8217;s an attached webserver, .mediaURL should also be set)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vocabulary">5. Vocabulary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every dbview has a .vocab which is a [vocabspec](<a href="https://github.com/sandhawke/vocabspec" class="bare">https://github.com/sandhawke/vocabspec</a>) instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instance_types">6. Instance Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various useful classes, nearly all of which implement approx the same
dbview interface, in roughly increasing order of complexity:</p>
</div>
<div class="sect2">
<h3 id="_inmem_basic_in_memory_store">6.1. Inmem: basic in-memory store</h3>
<div class="paragraph">
<p>Typically one creates a memstore and then relays behind it, rather
than re-implementing this interface.  Users can&#8217;t tell the
difference as long as we have room to store all the pages in
memory.
 *
The callback parameter to create/update/delete is to be called back
if/when the data is "saved".  We don&#8217;t do that, but hopefully some
watcher does, in which case it should invoke the callback (passing
it the page)</p>
</div>
</div>
<div class="sect2">
<h3 id="_filestore_on_disk_each_page_is_its_own_file">6.2. Filestore: on disk, each page is its own file</h3>

</div>
<div class="sect2">
<h3 id="__planned_proxyclient_estream_appears_as_db_but_all_operations_to_an_eventemitter">6.3. [PLANNED] ProxyClient(estream): appears as db, but all operations to an eventemitter</h3>
<div class="paragraph">
<p>doesn&#8217;t store anything, just relays everything to an
eventemitter.  We us ee.emit(event, obj) to send to the server and
ee.on/off/once(event, cb) to hear back.  Someone else can turn those
into postMessage or websockets or REST or whatever you want.</p>
</div>
<div class="sect3">
<h4 id="_companion_to_proxyserver_an_eventemitter_which_wraps_a_db">6.3.1. Companion to ProxyServer: an eventemitter which wraps a db</h4>
<div class="paragraph">
<p>An eventemitter that provides access to a db, speaking the other end
of the protocol proxyclient uses.</p>
</div>
<div class="paragraph">
<p>given</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">db2 = proxyclient(proxyserver(db1))</code></pre>
</div>
</div>
<div class="paragraph">
<p>db2 and db1 should be indistinguishable.</p>
</div>
<div class="paragraph">
<p>Of course in practice you&#8217;ll have some kind of transmission pipe
between them, or you wouldn&#8217;t bother.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__planned_cache_wrapper_which_caches_some_all_of_the_underlying_db">6.4. [PLANNED] Cache: wrapper which caches some/all of the underlying db</h3>

</div>
<div class="sect2">
<h3 id="__planned_multisource_wrapper_for_1_write_n_read_dbs_appearing_as_one_db">6.5. [PLANNED] Multisource: wrapper for 1-write N-read dbs, appearing as one db</h3>
<div class="paragraph">
<p>Wraps a db, also implementing .attach(dbN) for including other
read-only dbs.  Queries query them as well and merge the results.</p>
</div>
<div class="paragraph">
<p>Writes just go back to primary db.</p>
</div>
<div class="paragraph">
<p>BUT, depending on our delta model, etc, writes might APPEAR to
change the data, by blocking data from other sources.  That part&#8217;s
not quite there yet.</p>
</div>
<div class="sect3">
<h4 id="_db_include">6.5.1. db.include()</h4>

</div>
</div>
<div class="sect2">
<h3 id="__idea_accesscontrolled_gives_a_partial_view_of_a_db_based_on_user_attributes">6.6. [IDEA] Accesscontrolled: gives a partial view of a db based on 'user' attributes</h3>
<div class="ulist">
<ul>
<li>
<p>parameterized by uid and a trusted authinfo db</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="__idea_sigma_wrapper_which_turns_an_append_only_db_of_deltas_into_a_normal_db">6.7. [IDEA] Sigma: wrapper which turns an append-only db of deltas into a normal db</h3>
<div class="paragraph">
<p>Wraps an append-only db, where every page is "delta" (aka update, aka transaction) to produce a full db.</p>
</div>
<div class="sect3">
<h4 id="_db_deltas_links_to_underlying_dbview_with_deltas">6.7.1. db.deltas links to underlying dbview with deltas</h4>

</div>
</div>
<div class="sect2">
<h3 id="__idea_appendfile_on_disk_store_only_handles_deltas">6.8. [IDEA] Appendfile: on disk store, only handles deltas</h3>

</div>
<div class="sect2">
<h3 id="__idea_rulebase_computes_virtual_properties_virtual_pages_and_checks_validity">6.9. [IDEA] Rulebase: computes virtual properties, virtual pages, and checks validity</h3>
<div class="ulist">
<ul>
<li>
<p>with accessControled allowes sophisticated rules</p>
</li>
<li>
<p>probably needs a way to run safe JS functions</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="__idea_equalityreasoner">6.10. [IDEA] EqualityReasoner</h3>
<div class="paragraph">
<p>Gives a view of the data where some obj&#8217;s are "about" the same
thing, and so the data from one carries over to the other.  For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">db.add({ name: "Alice", age: 30 })
db.add({ name: "Alice", hairColor: "dark" })
db.addKey('name')
db.forEach(x =&gt; {
    // x = { name: 'Alice', age:30, hairColor: 'dark' }
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>uhhhhh.   Can&#8217;t really be done with current API</p>
</div>
<div class="paragraph">
<p>Except, if N pages can be merged, the db creates a new page, and
db.mergedInto(p1, pmergerd)
db.mergedInto(p2, pmergerd)</p>
</div>
<div class="paragraph">
<p>BUT that would still show through p1 and p2</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">db.filter({__smooshedIfPossible: true}).forEach( ... )

db.on('replace', ... )   or 'merge'N
...  p1 and p2 go away, and you get a new one?</code></pre>
</div>
</div>
<div class="paragraph">
<p>THIS SEEMS OBSCURE, but actually, it&#8217;s essential to making
decentralization work!</p>
</div>
<div class="paragraph">
<p>Do we need to change dbview?</p>
</div>
<div class="paragraph">
<p>? can you compare with ===</p>
</div>
<div class="paragraph">
<p>I think so, because of pointers / graphs</p>
</div>
<div class="sect3">
<h4 id="_db_addkey_prop">6.10.1. db.addKey (prop)</h4>

</div>
<div class="sect3">
<h4 id="_db_issamesubjectas_a_b">6.10.2. db.isSameSubjectAs (a, b)</h4>

</div>
<div class="sect3">
<h4 id="_db_makesamesubjectas_a_b">6.10.3. db.makeSameSubjectAs (a, b)</h4>

</div>
<div class="sect3">
<h4 id="_db_issamepageas_a_b">6.10.4. db.isSamePageAs (a, b)</h4>

</div>
<div class="sect3">
<h4 id="_db_makesamesubjectas_a_b_2">6.10.5. db.makeSameSubjectAs (a, b)</h4>

</div>
<div class="sect3">
<h4 id="_db_refmod_property_type">6.10.6. db.refmod(property, type)</h4>
<div class="paragraph">
<p>Set the "reference mode" for given property to be given type, which is one of: page, subject, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Needs to be known for every property&#8230;&#8203;.    Do we default to 'subject' unless you say 'page'</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-07-28 12:30:37 EDT
</div>
</div>
</body>
</html>